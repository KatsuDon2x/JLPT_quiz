<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sound Quiz</title>

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: radial-gradient(circle at top, #2b2f55, #0b0e1a);
  color: #fff;
}

.container {
  max-width: 420px;
  margin: 0 auto;
  padding: 20px;
}

.card {
  background: rgba(255,255,255,0.06);
  border-radius: 18px;
  padding: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.4);
}

h1 {
  margin-top: 0;
}

button {
  width: 100%;
  padding: 14px;
  margin: 8px 0;
  border-radius: 14px;
  border: none;
  background: rgba(255,255,255,0.1);
  color: #fff;
  font-size: 16px;
}

button.correct {
  background: #2ecc71;
}

button.wrong {
  background: #e74c3c;
}

.controls {
  display: flex;
  gap: 10px;
  margin-top: 14px;
}

.controls button {
  flex: 1;
}

.small {
  font-size: 13px;
  opacity: 0.8;
}
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <h1>Sound Quiz</h1>
    <div id="status">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

    <div id="quizArea" style="display:none;">
      <p id="progress"></p>
      <p id="question"></p>

      <audio id="audio" controls></audio>

      <div id="choices"></div>

      <div class="controls">
        <button id="prevBtn">â† å‰ã¸</button>
        <button id="retryBtn">ğŸ” ã“ã®å•é¡Œã‚’ã‚„ã‚Šç›´ã™</button>
        <button id="nextBtn">æ¬¡ã¸ â†’</button>
      </div>

      <p class="small">æ­£è§£æ•°: <span id="score">0</span></p>
      <p class="small">é–“é•ãˆã¦ã‚‚OKã€‚ã‚„ã‚Šç›´ã—ã¦è¦šãˆã‚‹ã‚¿ã‚¤ãƒ—ã€‚</p>
    </div>
  </div>
</div>

<script>
let data;
let index = 0;
let score = 0;
let answered = false;

fetch("sets/set-001.json")
  .then(res => res.json())
  .then(json => {
    data = json;
    document.getElementById("status").style.display = "none";
    document.getElementById("quizArea").style.display = "block";
    render();
  });

function render() {
  answered = false;
  const item = data.items[index];

  document.getElementById("progress").textContent =
    `${index + 1} / ${data.items.length}`;

  document.getElementById("question").textContent = item.prompt;

  const audio = document.getElementById("audio");
  audio.src = item.audio;
  audio.load();

  const choices = document.getElementById("choices");
  choices.innerHTML = "";

  item.choices.forEach((text, i) => {
    const btn = document.createElement("button");
    btn.textContent = text;
    btn.onclick = () => checkAnswer(btn, i);
    choices.appendChild(btn);
  });

  document.getElementById("score").textContent = score;
}

function checkAnswer(button, choiceIndex) {
  if (answered) return;
  answered = true;

  const correct = data.items[index].answerIndex;

  if (choiceIndex === correct) {
    button.classList.add("correct");
    score++;
  } else {
    button.classList.add("wrong");
  }

  document.getElementById("score").textContent = score;
}

document.getElementById("nextBtn").onclick = () => {
  if (index < data.items.length - 1) {
    index++;
    render();
  }
};

document.getElementById("prevBtn").onclick = () => {
  if (index > 0) {
    index--;
    render();
  }
};

document.getElementById("retryBtn").onclick = () => {
  render();
};
</script>
</body>
</html>
